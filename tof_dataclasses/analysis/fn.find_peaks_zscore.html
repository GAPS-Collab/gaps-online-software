<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Z-scores peak finding algorithm"><title>find_peaks_zscore in tof_dataclasses::analysis - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="tof_dataclasses" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0 (aedd173a2 2024-03-17)" data-channel="1.77.0" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-4c98445ec4002617.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../tof_dataclasses/index.html">tof_dataclasses</a><span class="version">0.10.0</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In tof_dataclasses::analysis</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../tof_dataclasses/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../index.html">tof_dataclasses</a>::<wbr><a href="index.html">analysis</a>::<wbr><a class="fn" href="#">find_peaks_zscore</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/tof_dataclasses/analysis.rs.html#441-476">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub fn find_peaks_zscore(
    nanoseconds: &amp;<a class="struct" href="https://doc.rust-lang.org/1.77.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.f32.html">f32</a>&gt;,
    voltages: &amp;<a class="struct" href="https://doc.rust-lang.org/1.77.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.f32.html">f32</a>&gt;,
    start_time: <a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.f32.html">f32</a>,
    window_size: <a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.f32.html">f32</a>,
    lag: <a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html">usize</a>,
    threshold: <a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.f64.html">f64</a>,
    influence: <a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.f64.html">f64</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.77.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.77.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;(<a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html">usize</a>, <a class="primitive" href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html">usize</a>)&gt;, <a class="enum" href="../errors/enum.WaveformError.html" title="enum tof_dataclasses::errors::WaveformError">WaveformError</a>&gt;</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Z-scores peak finding algorithm</p>
<p>Brakel, J.P.G. van (2014).
“Robust peak detection algorithm using z-scores”. 
Stack Overflow.
Available at: https://stackoverflow.com/questions/
22583391/peak-signal-detection-in-realtime-timeseries-data/
22640362#22640362 (version: 2020-11-08).</p>
<p>Robust peak detection algorithm (using z-scores)</p>
<p>[..] algorithm that works very well for these types of datasets.
It is based on the principle of dispersion:
if a new datapoint is a given x number of standard deviations away
from a moving mean, the algorithm gives a signal.
The algorithm is very robust because it constructs a separate moving mean
and deviation, such that previous signals do not corrupt
the signalling threshold for future signals.
The sensitivity of the algorithm is therefore robust to previous signals.</p>
<h2 id="arguments"><a class="doc-anchor" href="#arguments">§</a>Arguments:</h2>
<ul>
<li>nanoseconds   : calibrated waveform times</li>
<li>voltages      : calibrated waveform voltages</li>
<li>start_time    : restrict the algorithm on a 
certain time window, start 
at start_time</li>
<li>window_size   : in ns</li>
<li>lag           : The lag of the moving window that calculates the mean
and standard deviation of historical data.
A longer window takes more historical data in account.
A shorter window is more adaptive,
such that the algorithm will adapt to new information
more quickly.
For example, a lag of 5 will use the last 5 observations
to smooth the data.</li>
<li>threshold     : The “z-score” at which the algorithm signals.
Simply put, if the distance between a new datapoint
and the moving mean is larger than the threshold
multiplied with the moving standard deviation of the data,
the algorithm provides a signal.
For example, a threshold of 3.5 will signal if a datapoint
is 3.5 standard deviations away from the moving mean. </li>
<li>influence     : The influence (between 0 and 1) of new signals on
the calculation of the moving mean and moving standard deviation.
For example, an influence parameter of 0.5 gives new signals
half of the influence that normal datapoints have.
Likewise, an influence of 0 ignores signals completely
for recalculating the new threshold.
An influence of 0 is therefore the most robust option 
(but assumes stationarity);
putting the influence option at 1 is least robust.
For non-stationary data, the influence option should
therefore be put between 0 and 1.</li>
</ul>
</div></details></section></div></main></body></html>